<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Malla Curricular ‚Äì Profesorado en Psicolog√≠a</title>
<style>
  @font-face {
    font-family: 'Perfect Penmanship';
    src: url('KGPerfectPenmanship.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }
  :root {
    --color-fondo-general: #fffde7; /* amarillo pastel */
    --color-fondo-anos: #dbe9f4; /* celeste pastel suave */
    --color-fondo-bloques: #dbe9f4; /* celeste pastel suave igual a√±os */
    --color-aprobada: #c8f7c5;
    --color-regular: #f8bbd0;
    --color-libre: #e1bee7;
    --color-cursable: #ffe0b2;
    --color-bloqueada: #e0e0e0;
  }

  h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 1rem;
  }
html {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: var(--color-fondo-general);
}

body {
  margin: 0;
  padding: 1rem;
  color: #333;
  background-color: var(--color-fondo-general);
  overflow-y: auto;   /* ‚úÖ scroll vertical activado */
  overflow-x: hidden; /* üîí sin scroll lateral */
}

  /* Panel de configuraci√≥n */
#panel-colores {
  position: fixed;
  top: 0;
  left: -300px;
  width: 260px;
  height: 100vh;
  background: white;
  padding: 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  overflow-x: hidden;
  transition: left 0.3s ease;
  z-index: 999;
  display: flex;               /* volvemos a flex */
  flex-direction: column;     /* necesario para organizar inputs */
  gap: 1rem;                  /* espacio entre elementos */
  scrollbar-width: thin;
  max-height: 100vh;          /* asegura que no se corte */
  box-sizing: border-box;     /* incluye el padding en el alto */
}

 #panel-colores label {
  display: flex;
  flex-direction: column; /* Esto acomoda el texto arriba y el input abajo */
  font-size: 0.9rem;
  gap: 0.3rem;
}

#panel-colores label input,
#panel-colores label select {
  width: 100%;
}
  
  #panel-colores input[type=color] {
    width: 32px;
    height: 24px;
    border: none;
    padding: 0;
    cursor: pointer;
  }
#panel-colores::-webkit-scrollbar {
  width: 6px;
}

#panel-colores::-webkit-scrollbar-thumb {
  background-color: #bbb;
  border-radius: 4px;
}

  /* Malla en flex: a√±os como columnas */
  #malla {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1rem;
  }
  .year {
    background-color: var(--color-fondo-anos);
    border-radius: 10px;
    padding: 0.8rem;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    min-width: 240px;
    display: flex;
    flex-direction: column;
  }
  .year h3 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 0.8rem;
  }
  /* Bloques (Anual, Semestres) apilados vertical */
  .bloques {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .bloque {
    background-color: var(--color-fondo-bloques);
    border-radius: 8px;
    padding: 0.5rem 0.6rem;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
  }
  .bloque h4 {
    margin: 0 0 0.5rem 0.5rem;
    font-weight: bold;
    font-family: Arial, sans-serif;
  }
  /* Materias en columnas verticales (filas por materias) */
  .subject {
    background-color: var(--color-libre);
    border-radius: 8px;
    padding: 0.4rem 0.6rem;
    margin: 0.2rem 0.4rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-family: 'Perfect Penmanship', cursive;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .subject.estado-aprobada {
    background-color: var(--color-aprobada);
  }
  .subject.estado-regular {
    background-color: var(--color-regular);
  }
  .subject.estado-cursable {
    background-color: var(--color-cursable);
  }
  .subject.estado-libre {
    background-color: var(--color-libre);
  }
  .subject.bloqueada {
    background-color: var(--color-bloqueada);
    cursor: not-allowed;
    color: #777;
  }
  /* Scroll horizontal para malla si no cabe */
  @media (max-width: 768px) {
    #malla {
      flex-wrap: nowrap;
    }
  }
/* üçî Estilo del bot√≥n hamburguesa */
#toggle-menu {
  position: fixed;
  top: 1rem;
  left: 1rem;
  background-color: #333;
  color: white;
  border: none;
  font-size: 1.5rem;
  padding: 0.5rem 0.8rem;
  border-radius: 5px;
  cursor: pointer;
  z-index: 1000;
}

/* üßæ Men√∫ deslizante (panel de colores) */
#panel-colores {
  position: fixed;
  top: 0;
  left: -300px;
  width: 260px;
  height: 100%;
  background: white;
  padding: 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  transition: left 0.3s ease;
  z-index: 999;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* Cuando el panel est√° abierto */
#panel-colores.abierto {
  left: 0;
}

/* Bot√≥n de cerrar */
#cerrar-menu {
  align-self: flex-end;
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: #444;
  margin-bottom: 1rem;
}
:root {
  --color-letras: #333333;
  --color-bordes: #bbbbbb;
}

/* Aplicamos color de letras y bordes a materias */
.subject {
  color: var(--color-letras);
  border: 1px solid var(--color-bordes);
}
#panel-colores label select,
#panel-colores label input[type=range] {
  margin-left: auto;
  flex-grow: 1;
}
body {
  font-family: var(--fuente-letra);
  font-size: var(--tamano-letra);
}
:root {
  --fuente-titulo: 'Perfect Penmanship', cursive;
  --tamano-titulo: 24px;

  --fuente-anios: 'Perfect Penmanship', cursive;
  --tamano-anios: 20px;

  --fuente-materias: 'Perfect Penmanship', cursive;
  --tamano-materias: 18px;
}

/* Aplica fuente y tama√±o al t√≠tulo principal */
h2 {
  font-family: var(--fuente-titulo);
  font-size: var(--tamano-titulo);
}

/* Aplica fuente y tama√±o a los t√≠tulos de a√±o */
.year h3 {
  font-family: var(--fuente-anios);
  font-size: var(--tamano-anios);
}

/* Aplica fuente y tama√±o a las materias */
.subject {
  font-family: var(--fuente-materias);
  font-size: var(--tamano-materias);
}
/* Men√∫ contextual personalizado */
#menu-bordes {
  position: absolute;
  display: none;
  background: #fff;
  border: 1px solid #ccc;
  z-index: 1000;
  padding: 0.5rem;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  font-family: sans-serif;
  font-size: 0.9rem;
  border-radius: 6px;
}

#menu-bordes label {
  display: flex;
  flex-direction: column;
  margin-bottom: 0.4rem;
}

#menu-bordes select,
#menu-bordes input[type=color],
#menu-bordes input[type=number] {
  margin-top: 0.2rem;
  font-size: 0.9rem;
}

  /* üß© Estilo para bordes personalizados */
.borde-editable {
  border-style: solid;
  border-width: 0;
  border-color: #333;
}

.borde-top {
  border-top-width: var(--borde-grosor, 2px);
  border-top-style: var(--borde-estilo, solid);
  border-top-color: var(--borde-color, #333);
}
.borde-right {
  border-right-width: var(--borde-grosor, 2px);
  border-right-style: var(--borde-estilo, solid);
  border-right-color: var(--borde-color, #333);
}
.borde-bottom {
  border-bottom-width: var(--borde-grosor, 2px);
  border-bottom-style: var(--borde-estilo, solid);
  border-bottom-color: var(--borde-color, #333);
}
.borde-left {
  border-left-width: var(--borde-grosor, 2px);
  border-left-style: var(--borde-estilo, solid);
  border-left-color: var(--borde-color, #333);
}

/* üß© Para evitar que el men√∫ contextual se corte */
#menu-bordes {
  max-width: 220px;
  font-size: 0.9rem;
}

  .subject.aprobada {
  text-decoration: line-through;
  opacity: 0.5;
}
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-contenido {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 300px;
  box-shadow: 0 0 10px #333;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.modal-contenido h3 {
  margin-top: 0;
  text-align: center;
}

.modal-botones {
  display: flex;
  justify-content: space-between;
}
.titulo-principal {
  font-family: var(--fuente-titulo, 'Perfecte Penmanship'), cursive;
  font-size: var(--tamano-titulo, 32px);
}

.year h3 {
  font-family: var(--fuente-anos, 'Perfecte Penmanship'), cursive;
  font-size: var(--tamano-anos, 24px);
}

.subject {
  font-family: var(--fuente-materias, 'Perfecte Penmanship'), cursive;
  font-size: var(--tamano-materias, 16px);
}

</style>
</head>
<body>

<h2>Malla Curricular ‚Äì Profesorado en Psicolog√≠a</h2>

<!-- üçî Bot√≥n para abrir men√∫ -->
<button id="toggle-menu" title="Abrir men√∫">‚ò∞</button>

<!-- üé® Men√∫ deslizante -->
<div id="panel-colores" aria-label="Configuraci√≥n de colores">
  <button id="cerrar-menu" title="Cerrar men√∫">‚úï</button>
  <label for="color-fondo-general">Fondo general
    <input type="color" id="color-fondo-general" value="#fffde7" />
  </label>
  <label for="color-fondo-anos">Fondo a√±os
    <input type="color" id="color-fondo-anos" value="#dbe9f4" />
  </label>
  <label for="color-fondo-bloques">Fondo bloques
    <input type="color" id="color-fondo-bloques" value="#dbe9f4" />
  </label>
  <label for="color-aprobada">Estado aprobada
    <input type="color" id="color-aprobada" value="#c8f7c5" />
  </label>
  <label for="color-regular">Estado regular
    <input type="color" id="color-regular" value="#f8bbd0" />
  </label>
  <label for="color-cursable">Estado cursable
    <input type="color" id="color-cursable" value="#ffe0b2" />
  </label>
  <label for="color-libre">Estado libre
    <input type="color" id="color-libre" value="#e1bee7" />
  </label>
  <label for="color-bloqueada">Estado bloqueada
    <input type="color" id="color-bloqueada" value="#e0e0e0" />
  </label>
  <label for="color-letras">Color de letras
    <input type="color" id="color-letras" value="#333333" />
  </label>
  <label for="color-bordes">Color de bordes
    <input type="color" id="color-bordes" value="#bbbbbb" />
  </label>
<hr>

  <hr>
<h4>üé® Personalizar tipograf√≠a</h4>

<!-- Fuente y tama√±o del T√çTULO PRINCIPAL -->
<label for="fuente-titulo">Fuente T√≠tulo
  <select id="fuente-titulo">
    <option value="'Perfect Penmanship', cursive">Perfect Penmanship</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="'Segoe UI', sans-serif">Segoe UI</option>
    <option value="'Georgia', serif">Georgia</option>
    <option value="'Courier New', monospace">Courier New</option>
  </select>
</label>
<label for="tamano-titulo">Tama√±o T√≠tulo
  <input type="range" id="tamano-titulo" min="16" max="40" value="24" />
</label>

<!-- Fuente y tama√±o de los A√ëOS -->
<label for="fuente-anios">Fuente A√±os
  <select id="fuente-anios">
    <option value="'Perfect Penmanship', cursive">Perfect Penmanship</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="'Segoe UI', sans-serif">Segoe UI</option>
    <option value="'Georgia', serif">Georgia</option>
    <option value="'Courier New', monospace">Courier New</option>
  </select>
</label>
<label for="tamano-anios">Tama√±o A√±os
  <input type="range" id="tamano-anios" min="14" max="30" value="20" />
</label>

<!-- Fuente y tama√±o de las MATERIAS -->
<label for="fuente-materias">Fuente Materias
  <select id="fuente-materias">
    <option value="'Perfect Penmanship', cursive">Perfect Penmanship</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="'Segoe UI', sans-serif">Segoe UI</option>
    <option value="'Georgia', serif">Georgia</option>
    <option value="'Courier New', monospace">Courier New</option>
  </select>
</label>
<label for="tamano-materias">Tama√±o Materias
  <input type="range" id="tamano-materias" min="10" max="28" value="18" />
</label>
 
</div>
<!-- Men√∫ contextual para editar bordes -->
<div id="menu-bordes" style="display:none; position:absolute; background:white; border:1px solid #ccc; box-shadow:2px 2px 5px rgba(0,0,0,0.2); padding:10px; z-index:1000;">
  <label><input type="checkbox" data-borde="top"> Borde superior</label>
  <label><input type="checkbox" data-borde="right"> Borde derecho</label>
  <label><input type="checkbox" data-borde="bottom"> Borde inferior</label>
  <label><input type="checkbox" data-borde="left"> Borde izquierdo</label>
  <label>
    Estilo:
    <select id="estilo-borde">
      <option value="solid">L√≠nea</option>
      <option value="dashed">Punteado</option>
      <option value="dotted">Punteado fino</option>
      <option value="double">Doble</option>
    </select>
  </label>
  <label>
    Grosor:
    <input type="number" id="grosor-borde" value="2" min="1" max="10" style="width:50px">
  </label>
  <label>
    Color:
    <input type="color" id="color-borde" value="#333">
  </label>
  <button onclick="aplicarBordes()">Aplicar</button>
</div>
  
<!-- Contenedor malla -->
<div id="malla" role="table" aria-label="Malla curricular"></div>

<script>
  const ESTADOS = ['libre', 'cursable', 'regular', 'aprobada'];
  const defaultColors = {
    'color-fondo-general': '#fffde7',
    'color-fondo-anos': '#dbe9f4',
    'color-fondo-bloques': '#dbe9f4',
    'color-aprobada': '#c8f7c5',
    'color-regular': '#f8bbd0',
    'color-cursable': '#ffe0b2',
    'color-libre': '#e1bee7',
    'color-bloqueada': '#e0e0e0',
  'color-letras': '#333333',
  'color-bordes': '#bbbbbb'

  };

  // Cargar colores guardados o defaults
  function cargarColores() {
    for (const key in defaultColors) {
      const color = localStorage.getItem(key) || defaultColors[key];
      document.getElementById(key).value = color;
      document.documentElement.style.setProperty(`--${key.replace('color-', 'color-')}`, color);
    }
  }

  // Guardar y aplicar color
  function cambiarColor(e) {
    const id = e.target.id;
    const val = e.target.value;
    localStorage.setItem(id, val);
    document.documentElement.style.setProperty(`--${id.replace('color-', 'color-')}`, val);
  }

  // A√±adir listeners a inputs de color
  function initPanelColores() {
    for (const key in defaultColors) {
      const input = document.getElementById(key);
      input.addEventListener('input', cambiarColor);
    }
  }

  // Datos materias
  const materias = {
  "1": {
    "Anual": [
      {nombre: "Filosof√≠a", clave: "filosofia", requisitos: [], regularidad: []},
      {nombre: "Historia de la Psicolog√≠a", clave: "histopsi", requisitos: [], regularidad: []},
      {nombre: "Metodolog√≠a de la Investigaci√≥n", clave: "metodologia", requisitos: [], regularidad: []},
      {nombre: "Neuropsicolog√≠a", clave: "neuro", requisitos: [], regularidad: []},
      {nombre: "Sistema Educativo y Curr√≠culum", clave: "sistec", requisitos: [], regularidad: []}
    ],
    "1¬∫ Semestre": [
      {nombre: "Instituciones Educativas", clave: "instituciones", requisitos: [], regularidad: []},
      {nombre: "Psicolog√≠a General", clave: "psigral", requisitos: [], regularidad: []}
    ],
    "2¬∫ Semestre": [
      {nombre: "Introducci√≥n a la Educaci√≥n y Sujeto del Aprendizaje", clave: "introedu", requisitos: [], regularidad: []},
      {nombre: "Ling√º√≠stica", clave: "linguistica", requisitos: [], regularidad: []},
      {nombre: "Pr√°ctica I: Contexto Comunidad-Escuela. An√°lisis Institucional", clave: "practica1", requisitos: [], regularidad: []}
    ]
  },
  "2": {
    "Anual": [
      {nombre: "Estad√≠stica (Descriptiva y Muestral)", clave: "estadistica", requisitos: [], regularidad: []},
      {nombre: "Historia de la Educaci√≥n Latinoamericana y Argentina", clave: "historiaedu", requisitos: [], regularidad: []},
      {nombre: "Psicolog√≠a Evolutiva y Cultura (Ni√±o y Adolescente)", clave: "psievol", requisitos: ["psigral","neuro"], regularidad: ["psigral"]},
      {nombre: "Psicolog√≠a Profunda", clave: "psiprofunda", requisitos: ["psigral"], regularidad: ["psigral"]},
      {nombre: "Teolog√≠a", clave: "teologia", requisitos: ["filosofia"], regularidad: ["filosofia"]}
    ],
    "1¬∫ Semestre": [
      {nombre: "Filosof√≠a y Epistemolog√≠a de la Educaci√≥n", clave: "episte", requisitos: ["filosofia"], regularidad: []},
      {nombre: "Planeamiento, Programaci√≥n y Dise√±o de Proyectos Educativos", clave: "planeamiento", requisitos: ["instituciones","introedu","sistec"], regularidad: ["instituciones","introedu","sistec"]},
      {nombre: "Pr√°ctica II: Gesti√≥n Institucional, Curr√≠culum, Ense√±anza y Programaci√≥n Educativa", clave: "practica2", requisitos: ["practica1"], regularidad: ["practica1"]}
    ],
    "2¬∫ Semestre": [
      {nombre: "Did√°ctica General", clave: "didactica", requisitos: ["introedu"], regularidad: ["introedu"]},
      {nombre: "Psicolog√≠a de la Personalidad", clave: "psipersonalidad", requisitos: ["psigral"], regularidad: ["psigral"]},
      {nombre: "Psicolog√≠a Experimental", clave: "psiexp", requisitos: ["psigral","metodologia"], regularidad: ["psigral","metodologia"]}
    ]
  },
  "3": {
    "Anual": [
      {nombre: "Psicolog√≠a Educacional", clave: "psieducacional", requisitos: ["psievol"], regularidad: ["psievol"]}
    ],
    "1¬∫ Semestre": [
      {nombre: "Psicolog√≠a Evolutiva y Cultura de la Adultez y Senectud", clave: "psievoladulto", requisitos: ["psievol"], regularidad: ["psievol"]},
      {nombre: "Psicolog√≠a Social", clave: "psisocial", requisitos: ["psievol"], regularidad: ["psievol"]},
      {nombre: "Psicometr√≠a", clave: "psicometria", requisitos: ["estadistica"], regularidad: ["estadistica"]},
      {nombre: "Psicopatolog√≠a Infanto Juvenil (General y Especial)", clave: "psicopatinf", requisitos: ["psievol","psipersonalidad"], regularidad: ["psievol","psipersonalidad"]}
    ],
    "2¬∫ Semestre": [
      {nombre: "Did√°ctica Especial de la Psicolog√≠a", clave: "didacticaesp", requisitos: ["didactica"], regularidad: ["didactica"]},
      {nombre: "Din√°mica de Grupo", clave: "dinamica", requisitos: ["psisocial","psipersonalidad"], regularidad: ["psisocial","psipersonalidad"]},
      {nombre: "Pr√°ctica III: Observaciones y Pr√°cticas de la Ense√±anza en Contextos de Nivel Medio o Secundario", clave: "practica3", requisitos: ["practica2"], regularidad: ["practica2"]},
      {nombre: "Psicopatolog√≠a del Adulto (General y Especial)", clave: "psicopatadul", requisitos: ["psicopatinf"], regularidad: ["psicopatinf"]},
      {nombre: "T√©cnicas Proyectivas", clave: "tecproy", requisitos: ["psicometria","psievoladulto","psipersonalidad"], regularidad: ["psicometria","psievoladulto","psipersonalidad"]}
    ]
  },
  "4": {
    "1¬∫ Semestre": [
      {nombre: "Doctrina Social", clave: "doctrinasoc", requisitos: ["teologia"], regularidad: ["teologia"]},
      {nombre: "Evaluaci√≥n Educativa", clave: "evaluacion", requisitos: ["planeamiento"], regularidad: ["planeamiento"]},
      {nombre: "Mediaci√≥n Educativa y Resoluci√≥n de Conflictos", clave: "mediacion", requisitos: ["psisocial","dinamica","psieducacional"], regularidad: ["psisocial","dinamica","psieducacional"]},
      {nombre: "Orientaci√≥n Vocacional", clave: "orientacion", requisitos: ["psicometria","psievoladulto","tecproy","psieducacional"], regularidad: ["psicometria","psievoladulto","tecproy","psieducacional"]},
      {nombre: "Psicolog√≠a Especial y de la Diversidad", clave: "psiespdiv", requisitos: ["psievoladulto"], regularidad: ["psievoladulto"]},
      {nombre: "Trastornos Escolares y Problemas de Aprendizaje", clave: "trastornos", requisitos: ["psieducacional"], regularidad: ["psieducacional"]}
    ],
    "2¬∫ Semestre": [
      {nombre: "Drogodependencia y Abordajes Transdisciplinarios", clave: "drogodep", requisitos: ["psicopatadul","psisocial","psievoladulto","psieducacional"], regularidad: ["psicopatadul","psisocial","psievoladulto","psieducacional"]},
      {nombre: "Prueba de Suficiencia Idiom√°tica", clave: "idioma", requisitos: [], regularidad: []},
      {nombre: "Pr√°ctica IV: Observaciones y Pr√°cticas de la Ense√±anza en Contextos de Nivel Superior", clave: "practica4", requisitos: ["practica3"], regularidad: ["practica3"]},
      {nombre: "Psicolog√≠a de las Relaciones Humanas", clave: "psirelhum", requisitos: ["psisocial"], regularidad: ["psisocial"]},
      {nombre: "Tecnolog√≠a de la Comunicaci√≥n y la Informaci√≥n", clave: "tic", requisitos: [], regularidad: []},
      {nombre: "√âtica Profesional", clave: "etica", requisitos: ["doctrinasoc"], regularidad: ["doctrinasoc"]}
    ]
  }
};


  function getEstado(clave) {
    return localStorage.getItem('estado_' + clave) || 'libre';
  }
  function setEstado(clave, estado) {
    localStorage.setItem('estado_' + clave, estado);
    renderMalla();
  }

  // Chequea si tiene regularidad para cursar
  function cumpleRegularidad(reqs) {
    return reqs.every(clave => {
      const estado = getEstado(clave);
      return estado === 'regular' || estado === 'aprobada';
    });
  }

  // Chequea si tiene requisitos para finalizar
  function cumpleFinalizacion(reqs) {
    return reqs.every(clave => getEstado(clave) === 'aprobada');
  }

  function renderMalla() {
    const cont = document.getElementById('malla');
    cont.innerHTML = '';

    // Ordenar a√±os
    const anios = Object.keys(materias).sort((a,b) => a-b);

    anios.forEach(anio => {
      const yearDiv = document.createElement('section');
      yearDiv.className = 'year';
      yearDiv.setAttribute('role','grid');
      yearDiv.setAttribute('aria-label', `${anio}¬∞ A√±o`);
      yearDiv.innerHTML = `<h3>${anio}¬∞ A√±o</h3>`;
      yearDiv.dataset.id = `anio-${anio}`;

      const bloquesDiv = document.createElement('div');
      bloquesDiv.className = 'bloques';

      ['Anual', '1¬∫ Semestre', '2¬∫ Semestre'].forEach(bloqueName => {
        if(!materias[anio][bloqueName]) return;
        const bloqueDiv = document.createElement('div');
        bloqueDiv.className = 'bloque';
        bloqueDiv.setAttribute('role','rowgroup');
        bloqueDiv.dataset.id = `bloque-${anio}-${bloqueName}`;

        const titulo = document.createElement('h4');
        titulo.textContent = bloqueName;
        bloqueDiv.appendChild(titulo);

        materias[anio][bloqueName].forEach(mat => {
          let estado = getEstado(mat.clave);
          let claseEstado = 'estado-' + estado;
          let tooltip = '';
          let puedeCursar = cumpleRegularidad(mat.regularidad);
          let puedeFinalizar = cumpleFinalizacion(mat.requisitos);

          if(!puedeCursar) {
            claseEstado = 'bloqueada';
            const faltan = mat.regularidad.filter(k => !['regular','aprobada'].includes(getEstado(k)));
            tooltip = 'Falta regularidad en:\n' + faltan.join(', ');
          } else if(estado === 'libre' && puedeCursar && !puedeFinalizar) {
            claseEstado = 'estado-cursable';
            tooltip = 'Habilitada para cursar, pero no para rendir final';
          }

          const matDiv = document.createElement('div');
          matDiv.className = `subject ${claseEstado}`;
          matDiv.setAttribute('role','gridcell');
          matDiv.setAttribute('tabindex','0');
          matDiv.setAttribute('title', tooltip || mat.nombre);
          matDiv.textContent = mat.nombre;
matDiv.dataset.clave = mat.clave;
matDiv.dataset.id = mat.clave;
if (estado === 'aprobada') {
  matDiv.classList.add('aprobada');
}
          
          if(claseEstado !== 'bloqueada'){
            matDiv.onclick = () => {
  const actual = getEstado(mat.clave);
  let nuevo;
  switch(actual){
    case 'libre': nuevo = 'cursable'; break;
    case 'cursable': nuevo = 'regular'; break;
    case 'regular': nuevo = 'aprobada'; break;
    case 'aprobada': nuevo = 'libre'; break;
    default: nuevo = 'libre';
  }

  setEstado(mat.clave, nuevo);

  // A√±adir o quitar clase visual para tachado y opacidad
  if (nuevo === 'aprobada') {
    matDiv.classList.add('aprobada');
  } else {
    matDiv.classList.remove('aprobada');
  }
};

            // Soporte teclado: Enter o espacio cambia estado
            matDiv.onkeydown = e => {
              if(e.key === 'Enter' || e.key === ' '){
                e.preventDefault();
                matDiv.click();
              }
            };
          }
matDiv.ondblclick = () => {
  abrirPanelMateria(mat.clave, mat.nombre);
};

          bloqueDiv.appendChild(matDiv);
        });

        bloquesDiv.appendChild(bloqueDiv);
      });

      yearDiv.appendChild(bloquesDiv);
      cont.appendChild(yearDiv);
    });
  }

// üçî Abrir y cerrar men√∫
document.getElementById('toggle-menu').onclick = () => {
  document.getElementById('panel-colores').classList.add('abierto');
};
document.getElementById('cerrar-menu').onclick = () => {
  document.getElementById('panel-colores').classList.remove('abierto');
};

// Aplicar fuentes y tama√±os personalizados
function aplicarTipografias() {
  const config = [
    { idFuente: 'fuente-titulo', idTamano: 'tamano-titulo', varFuente: '--fuente-titulo', varTamano: '--tamano-titulo' },
    { idFuente: 'fuente-anios', idTamano: 'tamano-anios', varFuente: '--fuente-anios', varTamano: '--tamano-anios' },
    { idFuente: 'fuente-materias', idTamano: 'tamano-materias', varFuente: '--fuente-materias', varTamano: '--tamano-materias' }
  ];

  config.forEach(({ idFuente, idTamano, varFuente, varTamano }) => {
    const fuente = localStorage.getItem(idFuente) || document.getElementById(idFuente).value;
    const tamano = localStorage.getItem(idTamano) || document.getElementById(idTamano).value;
    document.getElementById(idFuente).value = fuente;
    document.getElementById(idTamano).value = tamano;
    document.documentElement.style.setProperty(varFuente, fuente);
    document.documentElement.style.setProperty(varTamano, tamano + 'px');

    document.getElementById(idFuente).onchange = e => {
      localStorage.setItem(idFuente, e.target.value);
      document.documentElement.style.setProperty(varFuente, e.target.value);
    };
    document.getElementById(idTamano).oninput = e => {
      localStorage.setItem(idTamano, e.target.value);
      document.documentElement.style.setProperty(varTamano, e.target.value + 'px');
    };
  });
}
  
  // Inicializar colores guardados y listeners
cargarColores();
initPanelColores();
renderMalla();
cargarBordes(); // ‚úÖ Esto hace que los bordes guardados se apliquen despu√©s del render
aplicarTipografias();
  function abrirPanelMateria(clave, nombre) {
  const panel = document.getElementById("panel-materia");
  panel.style.display = "flex";

  document.getElementById("nombre-materia").textContent = nombre;
  panel.dataset.clave = clave;

  const datos = JSON.parse(localStorage.getItem("fechas-materia") || "{}")[clave] || {};

  document.getElementById("fecha-final").value = datos.fechaFinal || "";
  document.getElementById("fecha-regularidad").value = datos.fechaRegularidad || "";
}

function guardarFechasMateria() {
  const clave = document.getElementById("panel-materia").dataset.clave;
  const fechaFinal = document.getElementById("fecha-final").value;
  const fechaRegularidad = document.getElementById("fecha-regularidad").value;

  const datos = JSON.parse(localStorage.getItem("fechas-materia") || "{}");
  datos[clave] = { fechaFinal, fechaRegularidad };
  localStorage.setItem("fechas-materia", JSON.stringify(datos));

  cerrarPanelMateria();
}

function cerrarPanelMateria() {
  document.getElementById("panel-materia").style.display = "none";
}
function aplicarTipografias() {
  const partes = [
    { idFuente: 'fuente-titulo', varFuente: '--fuente-titulo' },
    { idFuente: 'fuente-anos', varFuente: '--fuente-anos' },
    { idFuente: 'fuente-materias', varFuente: '--fuente-materias' },
    { idTamano: 'tamano-titulo', varTamano: '--tamano-titulo' },
    { idTamano: 'tamano-anos', varTamano: '--tamano-anos' },
    { idTamano: 'tamano-materias', varTamano: '--tamano-materias' }
  ];

  partes.forEach(({ idFuente, varFuente, idTamano, varTamano }) => {
    if (idFuente) {
      const fuente = localStorage.getItem(idFuente);
      if (fuente) {
        document.documentElement.style.setProperty(varFuente, fuente);
        document.getElementById(idFuente).value = fuente;
      }

      document.getElementById(idFuente).oninput = e => {
        localStorage.setItem(idFuente, e.target.value);
        document.documentElement.style.setProperty(varFuente, e.target.value);
      };
    }

    if (idTamano) {
      const tam = localStorage.getItem(idTamano);
      if (tam) {
        document.documentElement.style.setProperty(varTamano, tam + 'px');
        document.getElementById(idTamano).value = tam;
      }

      document.getElementById(idTamano).oninput = e => {
        localStorage.setItem(idTamano, e.target.value);
        document.documentElement.style.setProperty(varTamano, e.target.value + 'px');
      };
    }
  });
}

</script>

<div id="menu-bordes">
  <label>
    Lado a editar:
    <select id="borde-lado">
      <option value="border">Todos</option>
      <option value="borderTop">Arriba</option>
      <option value="borderRight">Derecha</option>
      <option value="borderBottom">Abajo</option>
      <option value="borderLeft">Izquierda</option>
    </select>
  </label>
  <label>
    Estilo:
    <select id="borde-estilo">
      <option value="solid">S√≥lido</option>
      <option value="dashed">Punteado</option>
      <option value="dotted">Punteado fino</option>
      <option value="double">Doble</option>
    </select>
  </label>
  <label>
    Color:
    <input type="color" id="borde-color" value="#000000">
  </label>
  <label>
    Grosor (px):
    <input type="number" id="borde-grosor" value="2" min="1" max="10">
  </label>
  <button onclick="aplicarBorde()">Aplicar</button>
</div>

<script>
// === MEN√ö CONTEXTUAL PARA BORDES PERSONALIZADOS ===
let elementoActual = null;

document.addEventListener("contextmenu", function(e) {
  const objetivo = e.target.closest(".subject, .bloque, .year");
  if (objetivo) {
    e.preventDefault();
    elementoActual = objetivo;
    const menu = document.getElementById("menu-bordes");
    menu.style.display = "block";
    menu.style.top = `${e.pageY}px`;
    menu.style.left = `${e.pageX}px`;
  } else {
    document.getElementById("menu-bordes").style.display = "none";
  }
});

document.addEventListener("click", function(e) {
  if (!e.target.closest("#menu-bordes")) {
    document.getElementById("menu-bordes").style.display = "none";
  }
});

function aplicarBordes() {
  if (!elementoActual) return;
  
  const estilo = document.getElementById("estilo-borde").value;
  const grosor = document.getElementById("grosor-borde").value + "px";
  const color = document.getElementById("color-borde").value;

  // Limpiar bordes anteriores
  elementoActual.classList.remove("borde-top", "borde-right", "borde-bottom", "borde-left");
  
  // Aplicar clases seg√∫n checkboxes
  const checks = document.querySelectorAll("#menu-bordes input[type=checkbox]");
  checks.forEach(check => {
    if (check.checked) {
      elementoActual.classList.add("borde-" + check.dataset.borde);
    }
  });

  // Marcar como editable y guardar estilo
  elementoActual.classList.add("borde-editable");
  elementoActual.style.setProperty("--borde-estilo", estilo);
  elementoActual.style.setProperty("--borde-grosor", grosor);
  elementoActual.style.setProperty("--borde-color", color);

  // Guardar en localStorage
  guardarBordes();
  document.getElementById("menu-bordes").style.display = "none";
}

function guardarBordes() {
  const todos = document.querySelectorAll(".borde-editable");
  const datos = [];
  todos.forEach(el => {
    datos.push({
      selector: el.dataset.id || generarID(el),
      clases: Array.from(el.classList).filter(c => c.startsWith("borde-")),
      estilo: {
        estilo: el.style.getPropertyValue("--borde-estilo"),
        grosor: el.style.getPropertyValue("--borde-grosor"),
        color: el.style.getPropertyValue("--borde-color")
      }
    });
  });
  localStorage.setItem("bordes-personalizados", JSON.stringify(datos));
}

function cargarBordes() {
  const datos = JSON.parse(localStorage.getItem("bordes-personalizados") || "[]");
  datos.forEach(item => {
    const el = document.querySelector(`[data-id='${item.selector}']`);
    if (el) {
      el.classList.add("borde-editable", ...item.clases);
      el.style.setProperty("--borde-estilo", item.estilo.estilo);
      el.style.setProperty("--borde-grosor", item.estilo.grosor);
      el.style.setProperty("--borde-color", item.estilo.color);
    }
  });
}

function generarID(el) {
  if (!el.dataset.id) {
    el.dataset.id = "el-" + Math.random().toString(36).substr(2, 9);
  }
  return el.dataset.id;
}

// Ejecutar al cargar
window.addEventListener("DOMContentLoaded", cargarBordes);
</script>
  <div id="panel-materia" class="modal" style="display: none;">
  <div class="modal-contenido">
    <h3 id="nombre-materia"></h3>

    <label for="fecha-final">üìÖ L√≠mite para rendir final:</label>
    <input type="date" id="fecha-final">

    <label for="fecha-regularidad">üìÖ L√≠mite de regularidad:</label>
    <input type="date" id="fecha-regularidad">

    <div class="modal-botones">
      <button onclick="guardarFechasMateria()">Guardar</button>
      <button onclick="cerrarPanelMateria()">Cerrar</button>
    </div>
  </div>
</div>

</body>
</html>
